<header>
  <article>
    <figure>
      <img src="assets/images/logos/logo_tiaki.png" alt="" />
    </figure>
    <div>
      <h1>Tiaki</h1>
      <h2>Mon profil utilisateur</h2>
    </div>
  </article>
  <article>
    <figure>
      <img src="assets/images/icones/gestion-utilisateur/yellowIcon.png" alt="" />
    </figure>
    <h3>Gestion des utilisateurs</h3>
  </article>
</header>
<section>
  <article class="search">
    <input pInputText type="text" [(ngModel)]="nomFiltre" (input)="onFilterChange()" placeholder="Nom" pInputText />
    <input pInputText type="text" [(ngModel)]="emailFiltre" (input)="onFilterChange()" placeholder="Email" pInputText />
    <input pInputText type="text" [(ngModel)]="roleFiltre" (input)="onFilterChange()" placeholder="Rôles" pInputText />
    <button pButton class="clear" (click)="clearFilters()" label="Effacer"></button>
    <button class="ajout" pButton routerLink="/intranet/gestion/ajout-utilisateurs" styleClass="p-button-success"
      type="submit">
      <img src="assets/images/icones/gestion-utilisateur/plus.svg" alt="plus" />Créer un utilisateur
    </button>
  </article>
  <article class="table-users">
    <table>
      <thead>
        <tr>
          <th>Selectionner</th>
          <th class="tri" colspan="1" (click)="triUtilisateursParNom()">
            Nom utilisateur
          </th>
          <th colspan="1">Adresse mail</th>
          <th colspan="1">Rôles</th>
          <th>Données Médicales</th>
          <th>Editer</th>
          <th>Supprimer</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUtilisateurs">
          <td>
            <input type="checkbox" [(ngModel)]="user.selected" (change)="onUserSelectChange(user)" />
          </td>
          <td>{{ user.nom }}</td>
          <td>{{ user.email }}</td>
          <td>
            <ng-container *ngFor="let role of user.roles; let last = last">
              {{ role }}<span *ngIf="!last">, </span>
            </ng-container>
          </td>
          <td>
            <figure>
              <img src="assets/images/icones/gestion-utilisateur/coeur.png" alt="favoris" />
            </figure>
          </td>
          <td>
            <figure (click)="openEditModal(user)">
              <img src="assets/images/icones/gestion-utilisateur/editer.png" alt="edit" />
            </figure>
          </td>
          <td>
            <figure (click)="openDeleteDataModal(user)">
              <img src="assets/images/icones/gestion-utilisateur/corbeille.png" alt="delete" />
            </figure>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="modal" [ngClass]="{'show': displayEditModal}">
      <div class="modal-content">
        <span class="close" (click)="closeEditModal()">&times;</span>
        <!-- Modale -->
        <section *ngIf="selectedUserForEdit">
          <div>
            <label for="nom">Nom:</label>
            <input pInputText type="text" id="nom" [ngModel]="selectedUserForEdit ? selectedUserForEdit.nom : ''"
              (ngModelChange)="
                selectedUserForEdit && (selectedUserForEdit.nom = $event)
              " />
          </div>
          <div>
            <label for="email">Email:</label>
            <input type="text" id="email" [ngModel]="selectedUserForEdit ? selectedUserForEdit.email : ''"
              (ngModelChange)="
                selectedUserForEdit && (selectedUserForEdit.email = $event)
              " />
          </div>
          <label for="roles">Roles:</label>
          <div *ngFor="let role of allRoles">
            <!-- <input *ngIf="selectedUserForEdit" type="checkbox" [checked]="getRoleCheckedState(role)" (change)="handleUserRoleChange(role, $event)" /> -->
            <input *ngIf="selectedUserForEdit" type="checkbox" [checked]="role | acces:selectedUserForEdit.roles" (change)="handleUserRoleChange(role, $event)" />
            {{ role }}
          </div>
          <button styleClass="p-button-" pButton (click)="closeEditModal()">Annuler</button>
          <button styleClass="p-button-success" pButton (click)="updateUser()">Enregistrer</button>
        </section>
      </div>
    </div>
  </article>
  <button class="erased" pButton *ngIf="selectedUsers.length > 0" (click)="deleteSelectedUsers()"
    label="Supprimer les utilisateurs sélectionnés"></button>
  <app-delete-data></app-delete-data>
</section>
